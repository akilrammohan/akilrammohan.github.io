---
import BaseLayout from '../../layouts/BaseLayout.astro';
import { getCollection } from 'astro:content';

const posts = await getCollection('writing', ({ data }) => {
  // In production, filter out drafts
  return import.meta.env.PROD ? !data.draft : true;
});

// Sort by date, newest first
posts.sort((a, b) => b.data.date.valueOf() - a.data.date.valueOf());
---

<BaseLayout title="Writing | Akil Rammohan">
  <h1>Writing</h1>

  <p class="intro">
    Thoughts and essays on various topics. Add new posts by creating markdown files in <code>src/content/writing/</code>.
  </p>

  {posts.length > 0 ? (
    <ul class="post-list">
      {posts.map(post => (
        <li class="post-item">
          <a href={`/writing/${post.id}`} class="post-link">
            <h2 class="post-title">{post.data.title}</h2>
            <p class="post-description">{post.data.description}</p>
            <time class="post-date" datetime={post.data.date.toISOString()}>
              {post.data.date.toLocaleDateString('en-US', { year: 'numeric', month: 'long', day: 'numeric' })}
            </time>
            {post.data.draft && <span class="draft-badge">Draft</span>}
          </a>
        </li>
      ))}
    </ul>
  ) : (
    <p class="empty-state">No posts yet. Check back soon!</p>
  )}
</BaseLayout>

<style>
  h1 {
    font-size: 2rem;
    font-weight: normal;
    margin-bottom: 1rem;
  }

  .intro {
    margin-bottom: 2rem;
    color: var(--text-muted);
  }

  .intro code {
    background: #f0f0f0;
    padding: 0.15rem 0.4rem;
    border-radius: 3px;
    font-size: 0.9em;
  }

  .post-list {
    list-style: none;
    display: flex;
    flex-direction: column;
    gap: 1.5rem;
  }

  .post-item {
    border-bottom: 1px solid #eee;
    padding-bottom: 1.5rem;
  }

  .post-item:last-child {
    border-bottom: none;
  }

  .post-link {
    display: block;
    text-decoration: none;
  }

  .post-link:hover .post-title {
    color: var(--color-tri-1);
  }

  .post-title {
    font-size: 1.25rem;
    font-weight: 600;
    margin-bottom: 0.5rem;
    transition: color 0.2s ease;
  }

  .post-description {
    color: var(--text-muted);
    margin-bottom: 0.5rem;
  }

  .post-date {
    font-size: 0.9rem;
    color: var(--text-muted);
  }

  .draft-badge {
    display: inline-block;
    background: var(--color-tri-4);
    color: var(--color-tri-4-contrast);
    font-size: 0.75rem;
    padding: 0.15rem 0.5rem;
    border-radius: 3px;
    margin-left: 0.5rem;
    vertical-align: middle;
  }

  .empty-state {
    color: var(--text-muted);
    font-style: italic;
  }
</style>
